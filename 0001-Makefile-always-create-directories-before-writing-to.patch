From abd2ee05a140062ed191ad87837ff875594e8fa3 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Zbigniew=20J=C4=99drzejewski-Szmek?= <zbyszek@in.waw.pl>
Date: Tue, 30 Jul 2013 17:30:17 -0400
Subject: [PATCH] Makefile: always create directories before writing to them

Simplify rules by removing $(TARGET_C) as explicit target.
---
 Makefile | 11 +++++------
 1 file changed, 5 insertions(+), 6 deletions(-)

diff --git a/Makefile b/Makefile
index b0ae800..2519e4d 100644
--- a/Makefile
+++ b/Makefile
@@ -149,22 +149,21 @@ generated-sources: \
 
 $(SRC_C)/NativeBlas.c: generated-sources
 
-$(TARGET_C):
-	mkdir $(TARGET_C)
-
-$(TARGET_C)/NativeBlas.o: $(SRC_C)/NativeBlas.c $(TARGET_C)
+$(TARGET_C)/NativeBlas.o: $(SRC_C)/NativeBlas.c
+	@mkdir -p "$(dir $@)"
 	$(CC) $(CFLAGS) $(INCDIRS) -c $(SRC_C)/NativeBlas.c -o $@
 
 $(TARGET_C)/jblas_arch_flavor.o: generated-sources
+	@mkdir -p "$(dir $@)"
 	$(CC) $(CFLAGS) $(INCDIRS) -c $(SRC_C)/jblas_arch_flavor.c -o $@
 
 # Move the compile library to the machine specific directory.
 $(FULL_LIB_PATH)/$(LIB)jblas.$(SO) : $(TARGET_C)/NativeBlas.$(SO)
-	mkdir -p $(FULL_LIB_PATH)
+	@mkdir -p "$(dir $@)"
 	mv "$<" "$@"
 
 $(LIB_PATH)/$(LIB)jblas_arch_flavor.$(SO): $(SRC_C)/jblas_arch_flavor.$(SO)
-	mkdir -p $(LIB_PATH)
+	@mkdir -p "$(dir $@)"
 	mv "$<" "$@"
 
 ######################################################################
-- 
1.8.3.1

